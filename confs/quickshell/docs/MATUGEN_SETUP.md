# Matugen Integration Setup Guide

This guide explains how to integrate matugen for dynamic wallpaper-based color theming in Quickshell.

## Architecture Overview

The color system uses a three-layer architecture:

1. **ColorScheme.qml** - Base color tokens (generated by matugen)
2. **WidgetStyle.qml** - Semantic color mappings
3. **Widgets** - Use WidgetStyle references only

## Current Status

âœ… **Completed:**
- ColorScheme.qml created with default colors
- WidgetStyle.qml updated to reference ColorScheme
- All widgets refactored to use ColorScheme colors
- Registered ColorScheme singleton in qmldir

ðŸ”„ **Next Steps:**
- Create matugen template
- Configure matugen
- Set up auto-reload

## File Structure

```
~/.config/quickshell/
â”œâ”€â”€ design/
â”‚   â”œâ”€â”€ ColorScheme.qml          # Color tokens (will be generated by matugen)
â”‚   â”œâ”€â”€ WidgetStyle.qml          # Semantic mappings
â”‚   â”œâ”€â”€ FloatingOSD.qml
â”‚   â””â”€â”€ qmldir
â”œâ”€â”€ matugen/
â”‚   â””â”€â”€ templates/
â”‚       â””â”€â”€ quickshell.qml       # Template for generating ColorScheme.qml
â””â”€â”€ MATUGEN_SETUP.md             # This file

~/.config/matugen/
â””â”€â”€ config.toml                   # Matugen configuration
```

## Step 1: Create Matugen Template

Create `~/.config/quickshell/matugen/templates/quickshell.qml`:

```qml
pragma Singleton
import QtQuick

QtObject {
    // Material Design 3 Color Tokens
    // Generated by matugen from wallpaper
    
    // Primary colors
    readonly property color primary: "{{colors.primary.default.hex}}"
    readonly property color onPrimary: "{{colors.on_primary.default.hex}}"
    readonly property color primaryContainer: "{{colors.primary_container.default.hex}}"
    readonly property color onPrimaryContainer: "{{colors.on_primary_container.default.hex}}"
    
    // Secondary colors
    readonly property color secondary: "{{colors.secondary.default.hex}}"
    readonly property color onSecondary: "{{colors.on_secondary.default.hex}}"
    readonly property color secondaryContainer: "{{colors.secondary_container.default.hex}}"
    readonly property color onSecondaryContainer: "{{colors.on_secondary_container.default.hex}}"
    
    // Tertiary colors
    readonly property color tertiary: "{{colors.tertiary.default.hex}}"
    readonly property color onTertiary: "{{colors.on_tertiary.default.hex}}"
    readonly property color tertiaryContainer: "{{colors.tertiary_container.default.hex}}"
    readonly property color onTertiaryContainer: "{{colors.on_tertiary_container.default.hex}}"
    
    // Error colors
    readonly property color error: "{{colors.error.default.hex}}"
    readonly property color onError: "{{colors.on_error.default.hex}}"
    readonly property color errorContainer: "{{colors.error_container.default.hex}}"
    readonly property color onErrorContainer: "{{colors.on_error_container.default.hex}}"
    
    // Surface colors
    readonly property color surface: "{{colors.surface.default.hex}}"
    readonly property color onSurface: "{{colors.on_surface.default.hex}}"
    readonly property color surfaceVariant: "{{colors.surface_variant.default.hex}}"
    readonly property color onSurfaceVariant: "{{colors.on_surface_variant.default.hex}}"
    readonly property color surfaceDim: "{{colors.surface_dim.default.hex}}"
    readonly property color surfaceBright: "{{colors.surface_bright.default.hex}}"
    
    // Outline colors
    readonly property color outline: "{{colors.outline.default.hex}}"
    readonly property color outlineVariant: "{{colors.outline_variant.default.hex}}"
    
    // Background colors
    readonly property color background: "{{colors.background.default.hex}}"
    readonly property color onBackground: "{{colors.on_background.default.hex}}"
    
    // Additional semantic colors
    readonly property color success: "{{colors.secondary.default.hex}}"
    readonly property color onSuccess: "{{colors.on_secondary.default.hex}}"
    
    readonly property color disabled: "{{colors.outline_variant.default.hex}}"
    readonly property color inactive: "{{colors.on_surface_variant.default.hex}}"
    
    // Text colors (for easy reference)
    readonly property color textPrimary: "{{colors.on_surface.default.hex}}"
    readonly property color textSecondary: "{{colors.on_surface_variant.default.hex}}"
    readonly property color textTertiary: "{{colors.outline.default.hex}}"
    readonly property color textDisabled: "{{colors.outline_variant.default.hex}}"
}
```

## Step 2: Configure Matugen

Create/edit `~/.config/matugen/config.toml`:

```toml
[config]
# Set the wallpaper path
# Can be set dynamically via command: matugen image /path/to/wallpaper.jpg

[templates.quickshell]
input_path = "~/.config/quickshell/matugen/templates/quickshell.qml"
output_path = "~/.config/quickshell/design/ColorScheme.qml"
```

## Step 3: Generate Colors

Run matugen to generate colors from your wallpaper:

```bash
# Generate from specific wallpaper
matugen image /path/to/your/wallpaper.jpg

# Or if you have a wallpaper manager integration
matugen image $(cat ~/.current_wallpaper)
```

## Step 4: Set Up Auto-Reload (Optional)

### Option A: File Watcher in Quickshell

Add to `shell.qml`:

```qml
import Quickshell.Io

Scope {
    // Watch for color scheme changes
    FileWatcher {
        path: Qt.resolvedUrl("design/ColorScheme.qml")
        onFileChanged: {
            console.log("Color scheme updated, reloading...")
            Quickshell.reload()
        }
    }
    
    // ... rest of your shell
}
```

### Option B: Wallpaper Manager Hook

If using hyprpaper, swww, or similar:

```bash
#!/bin/bash
# ~/.config/hypr/scripts/change_wallpaper.sh

WALLPAPER="$1"

# Set wallpaper
swww img "$WALLPAPER" --transition-type fade

# Generate colors
matugen image "$WALLPAPER"

# Reload Quickshell
quickshell -c reload
```

## Color Mappings

### Current Color Usage

| Widget | Accent Color | Source |
|--------|-------------|---------|
| Volume OSD | Green | `ColorScheme.secondary` |
| Brightness OSD | Yellow | `ColorScheme.tertiary` |
| Battery (charging) | Green | `ColorScheme.success` |
| Hover state | Primary | `ColorScheme.primary` |
| Normal background | Surface Variant | `ColorScheme.surfaceVariant` |

### Customizing Colors

To change widget-specific colors, edit the widget files:

```qml
// widgets/VolumeWidget.qml
FloatingOSD {
    accentColor: ColorScheme.secondary  // Change to .primary, .tertiary, etc.
}
```

## Testing

1. **Test with current colors:**
   ```bash
   quickshell
   ```

2. **Generate colors from wallpaper:**
   ```bash
   matugen image /path/to/wallpaper.jpg
   quickshell -c reload
   ```

3. **Test different wallpapers:**
   ```bash
   for img in ~/Wallpapers/*.jpg; do
       matugen image "$img"
       sleep 2
   done
   ```

## Troubleshooting

### Colors not updating
- Check if ColorScheme.qml was generated correctly
- Verify matugen template path in config.toml
- Ensure Quickshell reloaded after generation

### Widgets showing wrong colors
- Check if widget imports `ColorScheme` or uses `WidgetStyle`
- Verify color property names match ColorScheme.qml

### FileWatcher not triggering
- Ensure path is correct: `Qt.resolvedUrl("design/ColorScheme.qml")`
- Check Quickshell console for errors

## Future Enhancements

- [ ] Light/dark mode toggle
- [ ] Multiple color scheme presets
- [ ] Per-monitor color schemes
- [ ] Gradual color transitions
- [ ] Color scheme preview tool

## Resources

- [Matugen Wiki](https://github.com/InioX/matugen/wiki)
- [Material Design 3 Colors](https://m3.material.io/styles/color/overview)
- [Quickshell Documentation](https://quickshell.outfoxxed.me/)